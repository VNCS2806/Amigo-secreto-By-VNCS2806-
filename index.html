<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Amigo Secreto</title>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:radial-gradient(circle,#0b3d2e,#021a12);
  color:#fff;
  text-align:center;
}
.container{padding:40px 20px;}
.grid{
  display:none;
  grid-template-columns:repeat(auto-fill,90px);
  gap:18px;
  justify-content:center;
  margin-top:40px;
}
.card{
  width:90px;height:130px;
  background:linear-gradient(135deg,#b30000,#6d0000);
  border-radius:10px;
  cursor:pointer;
  font-size:42px;
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow:0 6px 12px rgba(0,0,0,.4);
}
input,button{
  padding:12px;
  font-size:16px;
  border-radius:10px;
  border:none;
}
button{
  background:#16a34a;
  color:#fff;
  cursor:pointer;
}
</style>
</head>

<body>
<div class="container" id="loginBox">
  <h1>üéÑ Amigo Secreto</h1>
  <p>Digite seu nome</p>
  <input id="nomeInput" placeholder="Seu nome">
  <br><br>
  <button id="btnEntrar" type="button">Entrar</button>
</div>

<div class="grid" id="grid"></div>
<div id="result"></div>

<script>
document.addEventListener('DOMContentLoaded', () => {

const EVENT_KEY = 'evento_amigo_secreto';
const USERS_KEY = 'usuarios_usados';
const ADMIN = 'viniciusadm';

const nomes = [
 'Alan','Dani','Vini','Alani','Vanda','Geraldo',
 'Lourdes','Andr√©','V√¢nia','C√°ssia','Anderson','Liz'
];

const alias = {};
nomes.forEach(n=>{
  alias[n.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'')] = n;
});
alias['vinicius'] = 'Vini';

function normalizar(t){
 return t.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').trim();
}

function gerarDerangement(lista){
 let arr;
 do{
  arr=[...lista].sort(()=>Math.random()-0.5);
 }while(arr.some((v,i)=>v===lista[i]));
 return arr;
}

function init(){
 if(!localStorage.getItem(EVENT_KEY)){
  const amigos = gerarDerangement(nomes);
  const cartas = nomes.map((n,i)=>({nome:n,amigo:amigos[i],pickedBy:null}));
  localStorage.setItem(EVENT_KEY,JSON.stringify(cartas));
 }
 if(!localStorage.getItem(USERS_KEY)){
  localStorage.setItem(USERS_KEY,JSON.stringify({}));
 }
}

function login(){
 const valor = document.getElementById('nomeInput').value;
 if(!valor){ alert('Digite seu nome'); return; }

 const nome = normalizar(valor);

 if(nome === ADMIN){
  abrirAdmin();
  return;
 }

 if(!alias[nome]){
  alert('Nome n√£o reconhecido');
  return;
 }

 const nomeReal = alias[nome];
 const usados = JSON.parse(localStorage.getItem(USERS_KEY));

 if(usados[nomeReal]){
  alert('Esse nome j√° foi usado');
  return;
 }

 window.usuarioAtual = nomeReal;
 document.getElementById('grid').style.display='grid';
 document.getElementById('loginBox').style.display='none';
 render();
}

function render(){
 const grid=document.getElementById('grid');
 grid.innerHTML='';
 const cartas=JSON.parse(localStorage.getItem(EVENT_KEY));
 cartas.forEach((c,i)=>{
  if(c.pickedBy) return;
  const d=document.createElement('div');
  d.className='card';
  d.textContent='üé¥';
  d.onclick=()=>pick(i);
  grid.appendChild(d);
 });
}

function pick(i){
 const cartas=JSON.parse(localStorage.getItem(EVENT_KEY));
 const usados=JSON.parse(localStorage.getItem(USERS_KEY));
 const c=cartas[i];
 if(c.pickedBy) return;

 c.pickedBy=window.usuarioAtual;
 usados[window.usuarioAtual]=true;

 localStorage.setItem(EVENT_KEY,JSON.stringify(cartas));
 localStorage.setItem(USERS_KEY,JSON.stringify(usados));

 document.getElementById('grid').style.display='none';
 document.getElementById('result').innerHTML=
  `üéÅ <b>${window.usuarioAtual}</b>, seu amigo secreto √©:<br><b>${c.amigo}</b>`;
}

function abrirAdmin(){
 const cartas=JSON.parse(localStorage.getItem(EVENT_KEY));
 let html='<h2>Admin</h2>';
 cartas.forEach(c=>{
  html+=`<p>${c.nome} ‚Üí ${c.pickedBy?c.amigo:'‚ùå'}</p>`;
 });
 html+=`<br><button onclick="resetar()">Resetar tudo</button>`;
 document.getElementById('loginBox').innerHTML=html;
}

window.resetar=()=>{
 localStorage.clear();
 location.reload();
};

document.getElementById('btnEntrar').addEventListener('click',login);
document.getElementById('btnEntrar').addEventListener('touchstart',e=>{
 e.preventDefault();
 login();
});

init();
});
</script>
</body>
</html>
