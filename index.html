import { useEffect, useState } from "react";
import { initializeApp } from "firebase/app";
import {
  getFirestore,
  collection,
  onSnapshot,
  doc,
  updateDoc
} from "firebase/firestore";

/* ===============================
   CONFIGURA√á√ÉO DO FIREBASE
   =============================== */
const firebaseConfig = {
  apiKey: process.env.NEXT_PUBLIC_API_KEY,
  authDomain: process.env.NEXT_PUBLIC_AUTH_DOMAIN,
  projectId: process.env.NEXT_PUBLIC_PROJECT_ID,
  storageBucket: process.env.NEXT_PUBLIC_STORAGE_BUCKET,
  messagingSenderId: process.env.NEXT_PUBLIC_MESSAGING_SENDER_ID,
  appId: process.env.NEXT_PUBLIC_APP_ID
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ===============================
   COMPONENTE PRINCIPAL
   =============================== */
export default function Home() {
  const [cards, setCards] = useState([]);

  useEffect(() => {
    return onSnapshot(collection(db, "cards"), snapshot => {
      setCards(snapshot.docs.map(doc => ({
        id: doc.id,
        ...doc.data()
      })));
    });
  }, []);

  const pickCard = async (card) => {
    if (card.picked) return;
    await updateDoc(doc(db, "cards", card.id), { picked: true });
    alert(`üéÅ Seu amigo secreto √©:\n\n${card.name}`);
  };

  return (
    <>
      <style jsx global>{`
        body {
          margin: 0;
          font-family: Arial, sans-serif;
          background: radial-gradient(circle, #0b3d2e, #021a12);
          color: #fff;
          text-align: center;
        }
      `}</style>

      <style jsx>{`
        .container {
          padding: 40px 20px;
        }

        h1 {
          margin-bottom: 5px;
        }

        p {
          opacity: 0.9;
        }

        .grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, 90px);
          gap: 18px;
          justify-content: center;
          margin-top: 40px;
        }

        .card {
          width: 90px;
          height: 130px;
          background: linear-gradient(135deg, #b30000, #6d0000);
          border-radius: 10px;
          cursor: pointer;
          font-size: 42px;
          display: flex;
          align-items: center;
          justify-content: center;
          box-shadow: 0 6px 12px rgba(0,0,0,.4);
          transition: transform .3s, box-shadow .3s;
        }

        .card:hover {
          transform: scale(1.08);
          box-shadow: 0 10px 20px rgba(0,0,0,.6);
        }

        footer {
          margin-top: 40px;
          font-size: 13px;
          opacity: 0.6;
        }
      `}</style>

      <div className="container">
        <h1>üéÑ Amigo Secreto ‚Äì Natal 2025</h1>
        <p>Escolha uma carta. Apenas uma chance.</p>

        <div className="grid">
          {cards.map(card =>
            !card.picked && (
              <div
                key={card.id}
                className="card"
                onClick={() => pickCard(card)}
              >
                üé¥
              </div>
            )
          )}
        </div>

        <footer>
          Boa sorte üçÄ
        </footer>
      </div>
    </>
  );
}
